# fix net-gw-api e2e tests

- [Add filtering secret informer label for internal-encryption 路 knative/serving@d4d5681](https://github.com/knative/serving/runs/7152434512?check_suite_focus=true)
  - look at everything that the e2e action runs
    - [serving/kind-e2e.yaml at main 路 knative/serving](https://github.com/knative/serving/blob/main/.github/workflows/kind-e2e.yaml)
      - [serving/kind-e2e.yaml at 838305e4e47719006b954946acd597cb53e30a58 路 knative/serving 路 GitHub](https://github.com/knative/serving/blob/838305e4e47719006b954946acd597cb53e30a58/.github/workflows/kind-e2e.yaml#L124)
    - tip: comment out all other tests
    - do not comment out these:
```
        - ingress: kourier-tls
          ingress-class: kourier
          enable-tls: 1

        - test-suite: runtime
          test-path: ./test/conformance/runtime/...

        - test-suite: api
          test-path: ./test/conformance/api/...

        - test-suite: e2e
          test-path: ./test/e2e
```
todo:
- find or get dave's profile script for setting up a kind cluster with metalb
- build the code locally, run the tests in the docker container
- add action teamate to the gh action while testing
  - run action against origin repo
- also change the kind cluster setup in the action to do auditing (see kind website docs)
  - in gke: turn on logging and monitoring (go to log viewer)
- create a script that I can curl and install things (ko, kubectl, etc)
---
- [[07-07]]
  - [[net-gateway-api]] automated test workflow needs to:
    - call all conformance tests
      - have the conformance specific setup
      - install each vendor
    - call all e2e tests
      - have the conformance specific setup
      - install each vendor
    - might have to pass a flag indicating vendor if the vendor installation is different for e2e vs conformance
    - might need to make calls to `./third_party` a relative path (using `"$(dirname $0)"/`)
    - might just have to source `common/sh` in all files

- [[07-08]]
  - [[net-gateway-api]] test scripts workflow:
    - e2e tests:
      - run by repository's GH action:
        - action takes care of:
          - setting up a cluster
          - configuring a Knative test environment (config + test/config and uploads test images)
        - require installing gateway vendor configuration for that vendor's testing
        - call the tests: `./test/kind-e2e-${{ matrix.ingress }}.sh`
      - run by prow job `integration-tests_net-gateway-api_main`
        - action takes care of:
          - setting up a cluster
        - require configuring a Knative test environment (config + test/config and uploads test images)
        - require installing gateway vendor configuration for that vendor's testing
        - call `./test/presubmit-tests.sh --integration-tests`
          - runs all `./test/e2e-*tests.sh` scripts, in sequence.
      - run individual tests (against local cluster)
        - require configuring a Knative test environment (config + test/config and uploads test images)
        - require installing gateway vendor configuration for that vendor's testinhg
        - call `./test/e2e-contour-tests.sh`?
    - conformance tests:
      - run by repository's GH action:
        - action takes care of:
          - setting up a cluster
        - conformance tests do not require configuring a Knative test environment
        - require installing gateway vendor configuration for that vendor's testing
        - call the tests: `./test/kind-e2e-${{ matrix.ingress }}.sh`


[//begin]: # "Autogenerated link references for markdown compatibility"
[07-07]: ../../2022/daily-logs/07-07.md "July 7th, Thursday"
[net-gateway-api]: ../../knative/net-gateway-api.md "net-gateway-api"
[07-08]: ../../2022/daily-logs/07-08.md "July 8th, Friday"
[//end]: # "Autogenerated link references"